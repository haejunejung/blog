# ESLint's flat config: Background

이 글에서는 **ESLint 설정 시스템의 발전 과정과 최신 설정 방식인 [Flat Config의 탄생 배경](https://eslint.org/blog/2022/08/new-config-system-part-1/)에 대해 다룹니다.**

## 목차
0. 개요
1. 초기 ESLint 설정 시스템과 "Config Cascade" (2013)
2. extends key (2014)
3. 개인 설정 (\~/.eslintrc) 지원 (2015)
4. root: true 속성 추가 (2016)
5. overrides key (2018)
6. extends를 overrides 내부에서 지원 (2019)
7. ESLint 설정 복잡성의 증가와 새로운 설정 시스템 제안 (2019)
8. Flat Config 도입 (2022)

## 0. 개요
하나의 프로젝트가 마치 한 사람이 작성한 코드처럼 보인다면, 그만큼 코드 스타일이 일관되며 개발자들이 같은 원칙을 공유하고 있다는 의미가 됩니다.
물론 한 사람이 작성하더라도 코드 스타일이 달라질 수 있지만, 전체적으로 통일된 스타일을 유지하는 것은 협업에서 중요한 요소입니다.

현재 백오피스를 개발하면서, 지난 몇 년간 작성된 코드를 분석하고 수정하며 새로운 기능을 추가하는 작업을 하고 있습니다.
방대한 코드 베이스를 보면서 코드 스타일이 파일마다 제각각인 문제를 발견했습니다. 예를 들면:
- React Hooks 선언 순서가 뒤죽박죽인 경우
- 어떤 파일에서는 import만 사용하고, 어떤 파일에서는 import type을 사용하는 경우
- 한 줄 return 시 \{\} 사용 여부

이처럼 일관되지 않은 코드 스타일은 유지보수를 어렵게 만들고, 새로운 개발자가 적응하는 데 걸리는 시간을 증가시킵니다. (~~어느 장단에 맞춰야 해!!!~~)
프로젝트 초기에 [ESLint](https://eslint.org/)와 [Prettier](https://prettier.io/)와 같은 도구를 엄격하게 설정했다면 이런 문제를 줄일 수 있었겠지만, 
현재 상황은 그렇지 않았습니다.

이 문제를 고민하던 중, 한 동료 개발자가 과거 경험을 공유해주었습니다. "변수를 타입 순서로, 알파벳 순서로 정리하고 있으며 **첫 코드 리뷰 당시 코드 스타일 문제로 첫 커밋에서 7번이나 리젝 당한 경험이 있다**"는 것이었습니다.
이 이야기를 들으면서, 기존 코드 스타일을 정리하고 일관되게 맞춰둔다면 앞으로 프로젝트에 합류하는 개발자들이 같은 문제로 혼란을 겪지 않을 것이라는 생각이 들었습니다. 
결과적으로 코드 이해도가 높이지고, 적응 속도가 빨라지며, 코드의 의도도 더욱 명확해질 것이라고 생각이 들었습니다.

이러한 문제를 해결하기 위해 ESLint를 적극적으로 활용하는 것이 좋겠다고 판단했습니다. ESLint는 프로젝트 전반의 코드 스타일을 통일할 수 있도록 도와주며, 협업을 더욱 원활하게 만들어 줍니다.
어떤 규칙을 적용할 지 고민하는 과정에서, 프론트엔드 개발자들이 공통적으로 사용할 수 있는 설정 파일을 만들어 공유한다면, 팀 내에서뿐만 아니라 다른 프로젝트에서도 일관된 코드 스타일을 유지할 수 있을 것이라고 생각했습니다.

## 1. 초기 ESLint 설정 시스템과 "Config Cascade" (2013)
초기 ESLint 설정 시스템은 매우 단순한 형태였습니다.
- .eslintrc 파일을 만들어 규칙을 직접 정의하면 되었습니다.
- 현재 디렉토리에서 .eslintrc 파일을 찾고, 없으면 부모 디렉토리로 올라가면서 추가 설정을 병합하는 방식\(=**Config Cascade**\)를 사용했습니다,
- JSHint와 같은 기존 Linter에서는 디렉토리별 설정이 불가능했지만, ESLint는 Config Cascade를 통해 이를 가능하게 했습니다.

예를 들면: 아래와 같이 각각의 디렉토리에 .eslintrc를 넣어 설정이 가능했습니다.
```typescript
/home/user/project/
 ├── .eslintrc (1)
 ├── src/
 │    ├── .eslintrc (2)
 │    ├── index.js
 │    ├── utils.js
```

### Config Cascade 장점
1. 디렉토리별 설정을 다르게 할 수 있습니다.
2. 기본적으로 모든 상위 디렉토리의 설정을 상속받기 때문에 설정 관리가 편리해졌습니다.


### Config Cascde 단점
1. 상위 디렉토리에 숨겨진 설정이 적용될 가능성이 있었습니다.
    - 사용자가 프로젝트 외부에 설정이 있는 걸 모르면, 예상치 못한 규칙이 적용되곤 했습니다. 
    - 내가 설정한 적 없는 규칙이 적용된다는 혼란이 발생하곤 했습니다.
2. 복잡한 프로젝트에서는 예측하기 어려운 설정 충돌이 발생했습니다.
    - 특정 파일이 여러 .eslintrc 설정을 병합할 때, 어떤 설정이 최종적으로 적용될지 직관적으로 알기 어려웠습니다.
3. 전역 설정을 방지하기 어려웠습니다.
    - 팀 프로젝트에서 개인 설정(ex., ~/.eslintrc)이 의도치 않게 적용되곤 했습니다.

## 2. extends key (2014)
프로젝트 간의 설정을 공유하기 위해서 **extends** key가 추가되었습니다.
- extends key를 사용하여 다른 설정을 가져와서 확장할 수 있도록 개선되었습니다.
- 결과적으로 eslint-config-\* 개념(**Shareable Configs**)이 탄생하는 계기가 되었습니다. 

아래와 같은 방식으로 정의가 가능해졌습니다.
```typescript
{
  "extends": ["eslint:recommended"],
  "rules": {
    "semi": ["error", "always"]
  }
}
```

### extends 장점
1. 공유된 설정이 가능해졌습니다. (eslint-config-airbnb, eslint-config-prettier, ...)
2. 팀에서 동일한 설정을 쉽게 공유 가능해졌습니다.
3. 프로젝트별로 다른 기본 규칙을 적용할 수 있습니다.

### extends 단점
1. Config Cascade와 기능이 중복되었습니다.
    - extends를 통해 설정을 계층적으로 관리할 수 있는데, Config Cascade와 기능이 겹쳤습니다.
    - 두 가지 방식이 혼재되면서 어떤 설정이 적용되는지 헷갈리는 문제가 발생했습니다.
2. 설정 충돌 문제가 발생했습니다.
    - 여러 개의 extends를 사용할 경우, 충돌이 일어날 가능성이 있었습니다.

## 3. 개인 설정 (\~/.eslintrc) 지원 (2015)
사용자가 자신만의 ESLint 설정을 홈 디렉토리 (\~/.eslintrc)에 저장할 수 있도록 지원했습니다.

### \~/.eslintrc 장점
1. 개인 환경에서는 일관된 ESLint 설정을 사용할 수 있게 되었습니다.
2. 새로운 프로젝트를 만들 때 매번 .eslintrc를 설정할 필요가 없어졌습니다.

### \~/.eslintrc 단점
1. 예상치 못한 설정이 적용되곤 했습니다.
    - 프로젝트에 \~/.eslintrc 파일이 없으면 ESLlint가 \~/.eslintrc를 자동으로 적용했습니다.
    - 개인 설정을 모르는 다른 팀원이 프로젝트를 실행할 때, 전혀 다른 결과가 나오곤 했습니다.
2. Config Cascade와 함께 적용될 경우, 어떤 설정이 적용될지 직관적으로 알기 어려워졌습니다.

## 4. root: true 속성 추가 (2016)
Config Cascade가 예기치 않게 동작하는 문제를 해결하기 위해 root: true 속성이 추가되었습니다.
이를 통해 상위 디렉토리 설정이 적용되지 않도록 강제하고, 예상치 못한 설정 충돌을 방지할 수 있게 되었습니다.

``` typescript
{
  "root": true,
  "extends": "eslint:recommended",
  "rules": {
    "semi": ["error", "always"]
  }
}
```

## 5. overrides key (2018)
파일별로 다른 규칙을 적용할 수 있도록 개선되었습니다.
특정 패턴의 파일\(ex., 테스트 파일, 빌드 스크립트)에는 다른 규칙을 적용할 수 있도록 **overrides** key가 추가되었습니다.

```typescript
{
  "rules": {
    "quotes": ["error", "double"]
  },
  "overrides": [
    {
      "files": ["*.test.js"],
      "rules": {
        "quotes": ["error", "single"]
      }
    }
  ]
}
```


## 6. extends를 overrides 내부에서 지원 (2019)
overrides는 특정 파일 패턴에 따라 설정을 변경할 수 있지만, 여전히 설정을 extends할 수는 없었습니다.
이를 해결하기 위해 overrides 내부에서도 extends를 사용할 수 있도록 기능을 확장했습니다.
이제 특정 파일 패턴에 대해 기존 공유 설정을 그대로 가져와 적용할 수 있게 되었습니다.

```typescript
{
  "rules": {
    "quotes": ["error", "double"]
  },

  "overrides": [
    {
      "files": ["bin/*.js", "lib/*.js"],
      "excludedFiles": "*.test.js",
      "extends": ["eslint:recommended"],
      "rules": {
        "quotes": ["error", "single"]
      }
    }
  ]
}
```

### extends를 overrides 내부에서 지원하면서 생긴 장점
1. 특정 패턴의 파일에도 기존 ESLint 설정을 확장 적용이 가능해졌습니다.
2. 공유 설정과 개별 설정을 보다 쉽게 조합할 수 있게 되었습니다.

### extends를 overrides 내부에서 지원하면서 생긴 문제점
1. 설정 병합 로직이 복잡해졌습니다.
    - overrides안에서 extends를 병합할 때, 글로벌 설정과 지역 설정이 어떻게 합쳐지는지 예측하기 어려워졌습니다.
    - 예를 들어, extends된 설정 안에서도 overrides를 사용할 경우, 최종 적용되는 설정을 이해하기 어려워졌습니다.
2. Glob 패턴 병합이 비직관적이었습니다.
    - extends가 추가되면서 glob 패턴을 어떻게 적용할지 결정하는 로직이 복잡해졌습니다.
    - 최종적으로 어떤 파일이 어떤 설정을 상속받는지 직관적으로 알기 어려워졌습니다.

## 7. ESLint 설정 복잡성의 증가와 새로운 설정 시스템 제안 (2019)
이 시점에서 ESLint 설정 시스템이 과도한 기능 추가로 유지보수가 어려운 상태가 되었습니다.
- 너무 많은 설정 방식이 존재하게 되었습니다.(Config Cascade, extends, overrides, root, .eslintrc.json, ...)
- extends와 overrides 조합으로 인해 규칙 병합이 예상하기 어려워졌습니다.
- 팀 내에서도 설정 시스템을 수정하는 것이 부담스러워질 정도로 복잡해졌습니다.

ESLint 팀은 이 문제를 해결하기 위해 기존 .eslintrc를 버리고 새로운 설정 시스템을 만들지 고민하였고,
이는 팀 내부에서도 "완전히 새롭게 설계" vs "기존 시스템을 개선"으로 의견이 갈렸고 18개월의 논의 끝에 **기존 시스템을 버리고 새로운 설정 시스템**을 만들기로 결정했습니다.
이 설정 시스템이 **Flat Config**입니다.

## 8. Flat Config 도입 (2022)
기존 .eslintrc 설정 방식의 복잡성을 해결하기 위해 ESLint v8.21.0에서 새로운 **Flat Config 시스템**을 도입하게 되었습니다.
이는 기존 ESLint 설정 방식과 유사하면서도 단순화된 설정 구조를 제공하였습니다.

```typescript
export default [
  {
    files: ["**/*.js"],
    rules: {
      quotes: ["error", "double"],
      semi: ["error", "always"]
    }
  },
  {
    files: ["tests/**/*.js"],
    rules: {
      quotes: ["error", "single"]
    }
  }
];
```

### Flat Config의 특징
- export default로 설정을 내보내는 방식를 채택하였습니다.
- files 배열로 파일 패턴을 지정하여 특정 규칙을 적용 가능하게 하였습니다.
- 기존 .eslintrc의 overrides, extends, root: true와 같은 개념을 한 곳에 통합했습니다.

## 마치며
이번 기회를 통해 **ESLint가 어떻게 발전해왔고, 앞으로 어떤 방향으로 나아갈지**에 대해 알게 되었습니다.  
개발을 시작한 초기부터 ESLint를 꾸준히 사용해왔지만, **그동안의 변화와 개선 과정에 이런 역사가 있었는지는 처음 알게 되었습니다**. 
특히, Flat Config가 단순히 설정 방식을 단순화하기 위한 것인지, **성능적인 관점에서도 고려된 변화인지 궁금해졌습니다**.  
또한, 팀 내에서도 **일관된 코드 스타일을 유지하는 것이 얼마나 중요한지 다시금 느끼게 되었고**, 이를 위해 더 나은 설정 방식과 도구를 고민해야겠다는 생각이 들었습니다.

## References
- [ESLint's new config system, Part1: Background](https://eslint.org/blog/2022/08/new-config-system-part-1/)
- [ESLint's new config system, Part2: Introduction to flat config](https://eslint.org/blog/2022/08/new-config-system-part-2/)
- [ESLint's new config system, Part3: Developer preview](https://eslint.org/blog/2022/08/new-config-system-part-3/)